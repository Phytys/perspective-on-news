<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Balanced News</title>
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
<meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
<header>
  <nav class="tabs">
    <a href="/" class="{{ 'on' if current_site=='all' else '' }}">Alla</a>
    {% for slug, meta in sites.items() %}
      <a href="/site/{{ slug }}"
         class="{{ 'on' if current_site==slug else '' }}">{{ meta.name }}</a>
    {% endfor %}
    <a href="/analytics" class="right">Analytics&nbsp;ðŸ“ˆ</a>
  </nav>  
  
  <h1>Balanced&nbsp;News</h1>
  <p class="tagline">Se nyheten â€” och hela sammanhanget.</p>
</header>

<main>
{% for art in articles %}
  <article class="card">
    <h2>{{ art.title }}</h2>
    {% if art.summary %}<p>{{ art.summary }}</p>{% endif %}
    <p><a href="{{ art.url }}" target="_blank" rel="noopener">LÃ¤s hos {{ art.site.title() }}</a></p>

    {% if art.nuanced_perspective %}
      <hr>
      <h3>Nyanserad bild</h3>
      {% set analysis = art.nuanced_perspective|from_json %}
      <div class="analysis">
        <h4>Huvudfakta</h4>
        <p>{{ analysis.main_facts }}</p>
        
        <h4>Bakgrund</h4>
        <p>{{ analysis.context }}</p>
        
        <h4>Perspektiv</h4>
        <p>{{ analysis.perspectives }}</p>
        
        <h4>Konsekvenser</h4>
        <p>{{ analysis.implications }}</p>
        
        {% if analysis.verification.verified_claims %}
        <h4>Verifierade pÃ¥stÃ¥enden</h4>
        <ul>
          {% for claim in analysis.verification.verified_claims %}
            <li>{{ claim }}</li>
          {% endfor %}
        </ul>
        {% endif %}
        
        {% if analysis.verification.corrected_claims %}
        <h4>Korrigerade pÃ¥stÃ¥enden</h4>
        <ul>
          {% for claim in analysis.verification.corrected_claims %}
            <li>{{ claim }}</li>
          {% endfor %}
        </ul>
        {% endif %}
        
        {% if analysis.sources %}
        <h4>KÃ¤llor</h4>
        <ul>
          {% for source in analysis.sources %}
            <li>{{ source }}</li>
          {% endfor %}
        </ul>
        {% endif %}
        
        <p class="meta">
          Analyserad: {{ art.analyzed_at.strftime("%Y-%m-%d %H:%M") }} UTC
          {% if art.last_updated_at != art.analyzed_at %}
            (Uppdaterad: {{ art.last_updated_at.strftime("%Y-%m-%d %H:%M") }} UTC)
          {% endif %}
        </p>
      </div>
    {% else %}
      <button class="check" data-id="{{ art.id }}">FÃ¥ nyanserad bild</button>
    {% endif %}
  </article>
{% endfor %}
</main>

<footer>
  <small>Uppdaterad {{ now.strftime("%Y-%m-%d %H:%M UTC") }} Â· Prototyp</small>
</footer>

<script>
document.addEventListener('click', async e => {
  if (!e.target.matches('button.check')) return;
  const btn = e.target, id = btn.dataset.id;
  btn.disabled = true; btn.textContent = 'â€¦';
  const r = await fetch(`/api/analyse/${id}`, {method: 'POST'});
  if (!r.ok) { btn.textContent = 'error'; return; }
  const j = await r.json();
  if (j.status !== 'ok' && j.status !== 'cached') { btn.textContent='error'; return; }
  location.reload();  // Reload to show new analysis
});
</script>
</body>
</html>
